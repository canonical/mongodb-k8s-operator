[32mINFO    [0m pytest_operator.plugin:plugin.py:834 Model status:

Model  Controller          Cloud/Region        Version  SLA          Timestamp
test   microk8s-localhost  microk8s/localhost  3.4.4    unsupported  01:47:20Z

App            Version  Status  Scale  Charm          Channel      Rev  Address         Exposed  Message
application             active      1  application                   0  10.152.183.185  no       
mongodb-k8s             active      3  mongodb-k8s                   0  10.152.183.183  no       
s3-integrator           active      1  s3-integrator  latest/edge   35  10.152.183.129  no       

Unit              Workload  Agent      Address      Ports  Message
application/0*    active    idle       10.1.110.18         
mongodb-k8s/0*    active    idle       10.1.110.13         
mongodb-k8s/1     active    executing  10.1.110.15         
mongodb-k8s/2     active    idle       10.1.110.16         
s3-integrator/0*  active    idle       10.1.110.17         

[32mINFO    [0m pytest_operator.plugin:plugin.py:840 Juju error logs:

unit-mongodb-k8s-0: 01:34:17 ERROR unit.mongodb-k8s/0.juju-log database-peers:0: Failed to create the operator user: non-zero exit code 1 executing ['/usr/bin/mongosh', 'mongodb://localhost/admin', '--quiet', '--eval', "db.createUser({  user: 'operator',  pwd: passwordPrompt(),  roles:[    {'role': 'userAdminAnyDatabase', 'db': 'admin'},     {'role': 'readWriteAnyDatabase', 'db': 'admin'},     {'role': 'clusterAdmin', 'db': 'admin'},   ],  mechanisms: ['SCRAM-SHA-256'],  passwordDigestor: 'server',})"], stdout='Enter password\n********************************', stderr='MongoServerError: not primary\n'
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-mongodb-k8s-0/charm/./src/charm.py", line 926, in _init_operator_user
    process.wait_output()
  File "/var/lib/juju/agents/unit-mongodb-k8s-0/charm/venv/ops/pebble.py", line 1771, in wait_output
    raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
ops.pebble.ExecError: non-zero exit code 1 executing ['/usr/bin/mongosh', 'mongodb://localhost/admin', '--quiet', '--eval', "db.createUser({  user: 'operator',  pwd: passwordPrompt(),  roles:[    {'role': 'userAdminAnyDatabase', 'db': 'admin'},     {'role': 'readWriteAnyDatabase', 'db': 'admin'},     {'role': 'clusterAdmin', 'db': 'admin'},   ],  mechanisms: ['SCRAM-SHA-256'],  passwordDigestor: 'server',})"], stdout='Enter password\n********************************', stderr='MongoServerError: not primary\n'
unit-mongodb-k8s-0: 01:34:23 ERROR unit.mongodb-k8s/0.juju-log database-peers:0: Failed to create the operator user: non-zero exit code 1 executing ['/usr/bin/mongosh', 'mongodb://localhost/admin', '--quiet', '--eval', "db.createUser({  user: 'operator',  pwd: passwordPrompt(),  roles:[    {'role': 'userAdminAnyDatabase', 'db': 'admin'},     {'role': 'readWriteAnyDatabase', 'db': 'admin'},     {'role': 'clusterAdmin', 'db': 'admin'},   ],  mechanisms: ['SCRAM-SHA-256'],  passwordDigestor: 'server',})"], stdout='Enter password\n********************************', stderr='MongoServerError: not primary\n'
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-mongodb-k8s-0/charm/./src/charm.py", line 926, in _init_operator_user
    process.wait_output()
  File "/var/lib/juju/agents/unit-mongodb-k8s-0/charm/venv/ops/pebble.py", line 1771, in wait_output
    raise ExecError[AnyStr](self._command, exit_code, out_value, err_value)
ops.pebble.ExecError: non-zero exit code 1 executing ['/usr/bin/mongosh', 'mongodb://localhost/admin', '--quiet', '--eval', "db.createUser({  user: 'operator',  pwd: passwordPrompt(),  roles:[    {'role': 'userAdminAnyDatabase', 'db': 'admin'},     {'role': 'readWriteAnyDatabase', 'db': 'admin'},     {'role': 'clusterAdmin', 'db': 'admin'},   ],  mechanisms: ['SCRAM-SHA-256'],  passwordDigestor: 'server',})"], stdout='Enter password\n********************************', stderr='MongoServerError: not primary\n'
unit-mongodb-k8s-1: 01:47:12 ERROR unit.mongodb-k8s/1.juju-log s3-credentials:4: Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/websocket/_socket.py", line 118, in recv
    bytes_ = _recv()
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/websocket/_socket.py", line 97, in _recv
    return sock.recv(bufsize)
TimeoutError: timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/pebble.py", line 2890, in exec
    control_ws = self._connect_websocket(task_id, 'control')
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/pebble.py", line 2978, in _connect_websocket
    ws.connect(url, socket=sock)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/websocket/_core.py", line 261, in connect
    self.handshake_response = handshake(self.sock, url, *addrs, **options)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/websocket/_handshake.py", line 65, in handshake
    status, resp = _get_resp_headers(sock)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/websocket/_handshake.py", line 141, in _get_resp_headers
    status, resp_headers, status_message = read_headers(sock)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/websocket/_http.py", line 351, in read_headers
    line = recv_line(sock)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/websocket/_socket.py", line 140, in recv_line
    c = recv(sock, 1)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/websocket/_socket.py", line 120, in recv
    raise WebSocketTimeoutException("Connection timed out")
websocket._exceptions.WebSocketTimeoutException: Connection timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/./src/charm.py", line 1555, in <module>
    main(MongoDBCharm)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/main.py", line 551, in main
    manager.run()
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/main.py", line 530, in run
    self._emit()
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/main.py", line 519, in _emit
    _emit_charm_event(self.charm, self.dispatcher.event_name)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/main.py", line 147, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/framework.py", line 348, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/framework.py", line 860, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/framework.py", line 950, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/lib/charms/data_platform_libs/v0/s3.py", line 768, in _on_relation_changed
    getattr(self.on, "credentials_changed").emit(
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/framework.py", line 348, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/framework.py", line 860, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/framework.py", line 950, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/lib/charms/mongodb/v1/mongodb_backups.py", line 172, in _on_s3_credential_changed
    self._configure_pbm_options(event)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/lib/charms/mongodb/v1/mongodb_backups.py", line 375, in _configure_pbm_options
    self._resync_config_options()
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/lib/charms/mongodb/v1/mongodb_backups.py", line 464, in _resync_config_options
    self.charm.run_pbm_command(["config", "--force-resync"])
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/./src/charm.py", line 1411, in run_pbm_command
    process = container.exec([Config.Backup.PBM_PATH] + cmd, environment=environment)
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/model.py", line 2872, in exec
    return self._pebble.exec(
  File "/var/lib/juju/agents/unit-mongodb-k8s-1/charm/venv/ops/pebble.py", line 2899, in exec
    raise ChangeError(change.err, change) from e
ops.pebble.ChangeError: cannot perform the following tasks:
- exec command "/usr/bin/pbm" (exec 81: timeout waiting for websocket connections: context deadline exceeded)
----- Logs from task 0 -----
2024-08-17T01:47:12Z ERROR exec 81: timeout waiting for websocket connections: context deadline exceeded
-----
unit-mongodb-k8s-1: 01:47:12 ERROR juju.worker.uniter.operation hook "s3-credentials-relation-changed" (via hook dispatching script: dispatch) failed: exit status 1

[32mINFO    [0m pytest_operator.plugin:plugin.py:904 Forgetting main...