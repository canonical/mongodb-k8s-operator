{"uid":"72a14f0c8c65d44d","name":"test_removal_of_non_primary_shard","fullName":"tests.integration.sharding_tests.test_sharding#test_removal_of_non_primary_shard","historyId":"09e31ea2bdc47f4190587a720a285af3","time":{"start":1727920879836,"stop":1727920879841,"duration":5},"description":"Tests safe removal of a shard that is not primary.","descriptionHtml":"<p>Tests safe removal of a shard that is not primary.</p>\n","status":"broken","statusMessage":"juju.errors.JujuAPIError: cannot add relation \"shard-two:sharding config-server-one:config-server\": relation shard-two:sharding config-server-one:config-server is dying, but not yet removed","statusTrace":"Traceback (most recent call last):\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/threadexception.py\", line 92, in pytest_runtest_call\n    yield from thread_exception_runtest_hook()\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/threadexception.py\", line 68, in thread_exception_runtest_hook\n    yield\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/unraisableexception.py\", line 95, in pytest_runtest_call\n    yield from unraisable_exception_runtest_hook()\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    yield\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/logging.py\", line 848, in pytest_runtest_call\n    yield from self._runtest_for(item, \"call\")\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/logging.py\", line 831, in _runtest_for\n    yield\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/capture.py\", line 879, in pytest_runtest_call\n    return (yield)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    return (yield)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/pytest_asyncio/plugin.py\", line 529, in inner\n    _loop.run_until_complete(task)\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\n    return future.result()\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/tests/integration/sharding_tests/test_sharding.py\", line 308, in test_removal_of_non_primary_shard\n    await ops_test.model.integrate(\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/model.py\", line 1543, in integrate\n    result = await app_facade.AddRelation(endpoints=endpoints, via_cidrs=None)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/facade.py\", line 486, in wrapper\n    reply = await f(*args, **kwargs)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/_client19.py\", line 995, in AddRelation\n    reply = await self.rpc(msg)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/facade.py\", line 659, in rpc\n    result = await self.connection.rpc(msg, encoder=TypeEncoder)\n  File \"/home/runner/work/mongodb-k8s-operator/mongodb-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py\", line 672, in rpc\n    raise errors.JujuAPIError(result)\njuju.errors.JujuAPIError: cannot add relation \"shard-two:sharding config-server-one:config-server\": relation shard-two:sharding config-server-one:config-server is dying, but not yet removed","flaky":false,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":1,"retriesStatusChange":true,"beforeStages":[{"name":"event_loop","time":{"start":1727920061767,"stop":1727920061768,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test","time":{"start":1727920061768,"stop":1727920062003,"duration":235},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tmp_path_factory","time":{"start":1727920061768,"stop":1727920061768,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail","time":{"start":1727920879835,"stop":1727920879836,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"abort_on_fail::0","time":{"start":1727920879843,"stop":1727920879843,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test::finalizer","time":{"start":1727920879850,"stop":1727920880201,"duration":351},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::2","time":{"start":1727920880201,"stop":1727920880202,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_close_event_loop","time":{"start":1727920880202,"stop":1727920880202,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_provide_clean_event_loop","time":{"start":1727920880202,"stop":1727920880202,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"group(1)"},{"name":"tag","value":"asyncio"},{"name":"parentSuite","value":"tests.integration.sharding_tests"},{"name":"suite","value":"test_sharding"},{"name":"host","value":"fv-az1426-682"},{"name":"thread","value":"13396-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.sharding_tests.test_sharding"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"9532ad246434cf56","status":"unknown","time":{}}],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":0,"broken":2,"skipped":0,"passed":50,"unknown":0,"total":52},"items":[{"uid":"3d58b061501e48c","reportUrl":"../2465//#testresult/3d58b061501e48c","status":"passed","time":{"start":1727834502420,"stop":1727835120405,"duration":617985}},{"uid":"3b28bc6b3c3fe963","reportUrl":"../2456//#testresult/3b28bc6b3c3fe963","status":"passed","time":{"start":1727747521478,"stop":1727748311714,"duration":790236}},{"uid":"16e9438e37a86f58","reportUrl":"../2444//#testresult/16e9438e37a86f58","status":"passed","time":{"start":1727661054947,"stop":1727661625170,"duration":570223}},{"uid":"d3ee0ecc799968d9","reportUrl":"../2443//#testresult/d3ee0ecc799968d9","status":"passed","time":{"start":1727574605802,"stop":1727575126097,"duration":520295}},{"uid":"a73ab071339e2a17","reportUrl":"../2438//#testresult/a73ab071339e2a17","status":"passed","time":{"start":1727401862920,"stop":1727402563112,"duration":700192}},{"uid":"c5a06d74eba7419b","reportUrl":"../2434//#testresult/c5a06d74eba7419b","status":"passed","time":{"start":1727315489381,"stop":1727316069074,"duration":579693}},{"uid":"c28c33975f5b9822","reportUrl":"../2429//#testresult/c28c33975f5b9822","status":"passed","time":{"start":1727229486862,"stop":1727230095817,"duration":608955}},{"uid":"3296d4e642d46f50","reportUrl":"../2421//#testresult/3296d4e642d46f50","status":"passed","time":{"start":1727142720991,"stop":1727143081907,"duration":360916}},{"uid":"36fe78f891c3e4d2","reportUrl":"../2357//#testresult/36fe78f891c3e4d2","status":"passed","time":{"start":1726192365157,"stop":1726192975301,"duration":610144}},{"uid":"961e48f7afb7931b","reportUrl":"../2348//#testresult/961e48f7afb7931b","status":"passed","time":{"start":1726105676718,"stop":1726106004564,"duration":327846}},{"uid":"54c02f42a89f3168","reportUrl":"../2330//#testresult/54c02f42a89f3168","status":"passed","time":{"start":1726019480282,"stop":1726019840081,"duration":359799}},{"uid":"52b3c488cee74e3c","reportUrl":"../2317//#testresult/52b3c488cee74e3c","status":"passed","time":{"start":1725846372961,"stop":1725846713060,"duration":340099}},{"uid":"95896a8727be1563","reportUrl":"../2316//#testresult/95896a8727be1563","status":"passed","time":{"start":1725760076513,"stop":1725761025375,"duration":948862}},{"uid":"4307689a55f6b9b6","reportUrl":"../2315//#testresult/4307689a55f6b9b6","status":"passed","time":{"start":1725673821788,"stop":1725674561720,"duration":739932}},{"uid":"37db3502e16139c1","reportUrl":"../2312//#testresult/37db3502e16139c1","status":"passed","time":{"start":1725587198637,"stop":1725587588140,"duration":389503}},{"uid":"384e86d2f9ab45ce","reportUrl":"../2309//#testresult/384e86d2f9ab45ce","status":"passed","time":{"start":1725501236984,"stop":1725501677240,"duration":440256}},{"uid":"d3b55b682303ee0c","reportUrl":"../2306//#testresult/d3b55b682303ee0c","status":"passed","time":{"start":1725414408329,"stop":1725415006905,"duration":598576}},{"uid":"4552403bca8a876d","reportUrl":"../2296//#testresult/4552403bca8a876d","status":"passed","time":{"start":1725328210715,"stop":1725328570716,"duration":360001}},{"uid":"e1d51226612f6f16","reportUrl":"../2293//#testresult/e1d51226612f6f16","status":"passed","time":{"start":1725242050480,"stop":1725242678804,"duration":628324}},{"uid":"316dbdfef8189762","reportUrl":"../2292//#testresult/316dbdfef8189762","status":"passed","time":{"start":1725155300364,"stop":1725155969932,"duration":669568}}]},"tags":["asyncio","group(1)"]},"source":"72a14f0c8c65d44d.json","parameterValues":[]}