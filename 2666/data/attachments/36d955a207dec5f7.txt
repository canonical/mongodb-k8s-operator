[32mINFO    [0m integration.upgrades.helpers:helpers.py:24 Upgrading shard-one
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: 
  shard-one/1 [idle] active: Primary
  shard-one/2 [idle] active: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: Primary
  shard-one/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/2 [executing] maintenance: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m integration.upgrades.helpers:helpers.py:38 Calling resume-refresh for shard-one
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/1 [executing] maintenance: stopping charm software
  shard-one/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/1 [executing] maintenance: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [executing] maintenance: stopping charm software
  shard-one/1 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
  shard-one/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [executing] maintenance: 
  shard-one/1 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
  shard-one/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: 
  shard-one/1 [idle] active: 
  shard-one/2 [idle] blocked: Charm revision (f9224f3-upgraded-locally built) is not up-to date with config-server (f9224f3-locally built).
[32mINFO    [0m integration.upgrades.helpers:helpers.py:24 Upgrading shard-two
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [idle] active: Primary
  shard-two/1 [idle] active: 
  shard-two/2 [idle] active: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-two/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-two/2 [executing] maintenance: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-two/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-two/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m integration.upgrades.helpers:helpers.py:38 Calling resume-refresh for shard-two
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [idle] active: Primary
  shard-two/1 [executing] maintenance: stopping charm software
  shard-two/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-two/1 [executing] maintenance: 
  shard-two/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [executing] maintenance: stopping charm software
  shard-two/1 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
  shard-two/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [executing] maintenance: 
  shard-two/1 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
  shard-two/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [executing] blocked: Charm revision (f9224f3-upgraded-locally built) is not up-to date with config-server (f9224f3-locally built).
  shard-two/1 [idle] blocked: Charm revision (f9224f3-upgraded-locally built) is not up-to date with config-server (f9224f3-locally built).
  shard-two/2 [idle] blocked: Charm revision (f9224f3-upgraded-locally built) is not up-to date with config-server (f9224f3-locally built).
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [idle] active: 
[32mINFO    [0m integration.upgrades.helpers:helpers.py:24 Upgrading config-server
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  config-server/0 [idle] waiting: Waiting for shards to upgrade/downgrade to revision f9224f3-locally built.
  config-server/1 [idle] waiting: Waiting for shards to upgrade/downgrade to revision f9224f3-locally built.
  config-server/2 [idle] waiting: Waiting for shards to upgrade/downgrade to revision f9224f3-locally built.
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  config-server/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  config-server/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  config-server/2 [executing] maintenance: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  config-server/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  config-server/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  config-server/2 [executing] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  config-server/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m integration.upgrades.helpers:helpers.py:38 Calling resume-refresh for config-server
[32mINFO    [0m pytest_operator.plugin:plugin.py:903 Model status:

Model  Controller          Cloud/Region        Version  SLA          Timestamp
test   microk8s-localhost  microk8s/localhost  3.5.3    unsupported  02:01:16Z

App            Version  Status   Scale  Charm        Channel  Rev  Address         Exposed  Message
application             waiting      1  application             0  10.152.183.175  no       installing agent
config-server           blocked    2/3  mongodb-k8s             5  10.152.183.251  no       Refreshing. Verify highest unit is healthy & run `resume-refresh` action. To rollback, `juju refresh` to last revision
shard-one               waiting      3  mongodb-k8s             3  10.152.183.227  no       waiting for units to settle down
shard-two               waiting      3  mongodb-k8s             4  10.152.183.24   no       waiting for units to settle down

Unit              Workload  Agent  Address       Ports  Message
application/0*    waiting   idle   10.1.141.72          
config-server/0   active    idle   10.1.141.79          MongoDB 6.0.6 running (restart pending); Charm revision 1
config-server/1*  unknown   lost   10.1.141.80          agent lost, see 'juju show-status-log config-server/1'
config-server/2   active    idle   10.1.141.106         MongoDB 6.1.6+testupgrade running;  Charm revision 1
shard-one/0*      blocked   idle   10.1.141.102         Charm revision (f9224f3-upgraded-locally built) is not up-to date with config-server (f9224f3-locally built).
shard-one/1       blocked   idle   10.1.141.101         Charm revision (f9224f3-upgraded-locally built) is not up-to date with config-server (f9224f3-locally built).
shard-one/2       blocked   idle   10.1.141.100         Charm revision (f9224f3-upgraded-locally built) is not up-to date with config-server (f9224f3-locally built).
shard-two/0*      active    idle   10.1.141.105         
shard-two/1       blocked   idle   10.1.141.104         Charm revision (f9224f3-upgraded-locally built) is not up-to date with config-server (f9224f3-locally built).
shard-two/2       blocked   idle   10.1.141.103         Charm revision (f9224f3-upgraded-locally built) is not up-to date with config-server (f9224f3-locally built).

[32mINFO    [0m pytest_operator.plugin:plugin.py:909 Juju error logs:

unit-config-server-1: 01:41:48 ERROR unit.config-server/1.juju-log config-server:7: Failed to add shard shard-one to the config server, error=OperationFailure("Authentication failed., full error: {'ok': 0.0, 'errmsg': 'Authentication failed.', 'code': 18, 'codeName': 'AuthenticationFailed', '$clusterTime': {'clusterTime': Timestamp(1729215707, 3), 'signature': {'hash': b'\\xa8\\xedw(I\\x84\\x1c\\xe5\\xc5\\x9f\\x13\\x0e1]\\x17\\x1a\\xcf+r\\x11', 'keyId': 7426924256459489283}}, 'operationTime': Timestamp(1729215707, 3)}")
unit-config-server-1: 01:41:48 ERROR unit.config-server/1.juju-log config-server:7: shard-one shard does not have the same auth as the config server.
unit-config-server-1: 01:41:53 ERROR unit.config-server/1.juju-log config-server:7: Failed to add shard shard-one to the config server, error=OperationFailure('Authentication failed., full error: {\'ok\': 0.0, \'errmsg\': \'Authentication failed.\', \'code\': 18, \'codeName\': \'AuthenticationFailed\', \'$clusterTime\': {\'clusterTime\': Timestamp(1729215713, 1), \'signature\': {\'hash\': b\'4Ywb\\x97]\\xe4\\xb3Mc$U\\xaa2"\\x08<\\xbbf\\xe9\', \'keyId\': 7426924256459489283}}, \'operationTime\': Timestamp(1729215713, 1)}')
unit-config-server-1: 01:41:53 ERROR unit.config-server/1.juju-log config-server:7: shard-one shard does not have the same auth as the config server.
unit-config-server-1: 01:42:24 ERROR unit.config-server/1.juju-log config-server:8: Failed to add shard shard-two to the config server, error=OperationFailure("Authentication failed., full error: {'ok': 0.0, 'errmsg': 'Authentication failed.', 'code': 18, 'codeName': 'AuthenticationFailed', '$clusterTime': {'clusterTime': Timestamp(1729215744, 2), 'signature': {'hash': b'c2y\\x11y\\x90\\xfd\\x13\\x92\\x82\\x13Nn\\xa0Bf\\x8au\\xd1\\xac', 'keyId': 7426924256459489283}}, 'operationTime': Timestamp(1729215744, 2)}")
unit-config-server-1: 01:42:24 ERROR unit.config-server/1.juju-log config-server:8: shard-two shard does not have the same auth as the config server.
unit-config-server-1: 01:42:41 ERROR unit.config-server/1.juju-log config-server:8: Failed to add shard shard-two to the config server, error=OperationFailure('Could not find host matching read preference { mode: "primary" } for set shard-two, full error: {\'ok\': 0.0, \'errmsg\': \'Could not find host matching read preference { mode: "primary" } for set shard-two\', \'code\': 133, \'codeName\': \'FailedToSatisfyReadPreference\', \'$clusterTime\': {\'clusterTime\': Timestamp(1729215759, 7), \'signature\': {\'hash\': b\']:\\x9ab}\\xcb\\xfc%&J\\x06\\xafwFW\\x15\\x84\\x8d\\xd98\', \'keyId\': 7426924256459489283}}, \'operationTime\': Timestamp(1729215759, 7)}')
unit-config-server-1: 01:42:41 ERROR unit.config-server/1.juju-log config-server:8: Failed to add shard-two to cluster
unit-config-server-1: 01:42:41 ERROR unit.config-server/1.juju-log config-server:8: Deferring _on_relation_event for shards interface since: error=OperationFailure('Could not find host matching read preference { mode: "primary" } for set shard-two, full error: {\'ok\': 0.0, \'errmsg\': \'Could not find host matching read preference { mode: "primary" } for set shard-two\', \'code\': 133, \'codeName\': \'FailedToSatisfyReadPreference\', \'$clusterTime\': {\'clusterTime\': Timestamp(1729215759, 7), \'signature\': {\'hash\': b\']:\\x9ab}\\xcb\\xfc%&J\\x06\\xafwFW\\x15\\x84\\x8d\\xd98\', \'keyId\': 7426924256459489283}}, \'operationTime\': Timestamp(1729215759, 7)}')

[32mINFO    [0m pytest_operator.plugin:plugin.py:991 Forgetting model main...