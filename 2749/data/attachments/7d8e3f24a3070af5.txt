[32mINFO    [0m integration.upgrades.helpers:helpers.py:24 Upgrading shard-one
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: 
  shard-one/1 [idle] active: Primary
  shard-one/2 [idle] active: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/2 [executing] maintenance: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/2 [executing] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m integration.upgrades.helpers:helpers.py:39 Calling resume-refresh for shard-one
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/1 [executing] maintenance: stopping charm software
  shard-one/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/1 [executing] maintenance: 
  shard-one/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-one/1 [executing] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
  shard-one/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [executing] maintenance: 
  shard-one/1 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
  shard-one/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [executing] active: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-one/0 [idle] active: 
  shard-one/1 [idle] active: 
  shard-one/2 [idle] active: 
[32mINFO    [0m integration.upgrades.helpers:helpers.py:24 Upgrading shard-two
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [idle] active: Primary
  shard-two/1 [idle] active: 
  shard-two/2 [idle] active: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-two/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-two/2 [executing] maintenance: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-two/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-two/2 [executing] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/0 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-two/1 [idle] active: MongoDB 6.0.6 running (restart pending); Charm revision 1
  shard-two/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  shard-two/2 [idle] active: MongoDB 6.1.6+testupgrade running;  Charm revision 1
[32mINFO    [0m integration.upgrades.helpers:helpers.py:39 Calling resume-refresh for shard-two
[32mINFO    [0m pytest_operator.plugin:plugin.py:903 Model status:

Model  Controller          Cloud/Region        Version  SLA          Timestamp
test   microk8s-localhost  microk8s/localhost  3.5.3    unsupported  01:52:18Z

App            Version  Status   Scale  Charm        Channel  Rev  Address         Exposed  Message
application             waiting      1  application             0  10.152.183.85   no       installing agent
config-server           waiting      3  mongodb-k8s             0  10.152.183.195  no       installing agent
shard-one               waiting      3  mongodb-k8s             3  10.152.183.120  no       waiting for units to settle down
shard-two               blocked    2/3  mongodb-k8s             4  10.152.183.230  no       Refreshing. Verify highest unit is healthy & run `resume-refresh` action. To rollback, `juju refresh` to last revision

Unit              Workload  Agent  Address       Ports  Message
application/0*    waiting   idle   10.1.102.200         
config-server/0*  waiting   idle   10.1.102.206         Waiting for shards to upgrade/downgrade to revision b73d14a-locally built.
config-server/1   waiting   idle   10.1.102.209         Waiting for shards to upgrade/downgrade to revision b73d14a-locally built.
config-server/2   waiting   idle   10.1.102.208         Waiting for shards to upgrade/downgrade to revision b73d14a-locally built.
shard-one/0*      active    idle   10.1.102.230         
shard-one/1       blocked   idle   10.1.102.229         Charm revision (b73d14a-upgraded-locally built) is not up-to date with config-server (b73d14a-locally built).
shard-one/2       blocked   idle   10.1.102.228         Charm revision (b73d14a-upgraded-locally built) is not up-to date with config-server (b73d14a-locally built).
shard-two/0       active    idle   10.1.102.225         MongoDB 6.0.6 running (restart pending); Charm revision 1
shard-two/1*      unknown   lost   10.1.102.227         agent lost, see 'juju show-status-log shard-two/1'
shard-two/2       active    idle   10.1.102.231         MongoDB 6.1.6+testupgrade running;  Charm revision 1

[32mINFO    [0m pytest_operator.plugin:plugin.py:909 Juju error logs:

unit-config-server-0: 01:40:08 ERROR unit.config-server/0.juju-log config-server:7: Failed to add shard shard-one to the config server, error=OperationFailure("Authentication failed., full error: {'ok': 0.0, 'errmsg': 'Authentication failed.', 'code': 18, 'codeName': 'AuthenticationFailed', '$clusterTime': {'clusterTime': Timestamp(1729647607, 2), 'signature': {'hash': b'\\x88\\xb62<\\xf8\\xe5\\xcc\\xeb=\\xe8\\x1b4O\\xb7\\xe8\\x8b\\xe49\\x16U', 'keyId': 7428779192705089561}}, 'operationTime': Timestamp(1729647607, 2)}")
unit-config-server-0: 01:40:08 ERROR unit.config-server/0.juju-log config-server:7: shard-one shard does not have the same auth as the config server.
unit-config-server-0: 01:40:39 ERROR unit.config-server/0.juju-log config-server:8: Failed to add shard shard-two to the config server, error=OperationFailure('Authentication failed., full error: {\'ok\': 0.0, \'errmsg\': \'Authentication failed.\', \'code\': 18, \'codeName\': \'AuthenticationFailed\', \'$clusterTime\': {\'clusterTime\': Timestamp(1729647637, 4), \'signature\': {\'hash\': b" /\\xe1#T\\xb7ZT\\\\\\x8a\\xb7~\\xf0\\xc7\\xa5\\xf8\'Oia", \'keyId\': 7428779192705089561}}, \'operationTime\': Timestamp(1729647637, 4)}')
unit-config-server-0: 01:40:39 ERROR unit.config-server/0.juju-log config-server:8: shard-two shard does not have the same auth as the config server.
unit-config-server-0: 01:40:56 ERROR unit.config-server/0.juju-log config-server:8: Failed to add shard shard-two to the config server, error=OperationFailure('Could not find host matching read preference { mode: "primary" } for set shard-two, full error: {\'ok\': 0.0, \'errmsg\': \'Could not find host matching read preference { mode: "primary" } for set shard-two\', \'code\': 133, \'codeName\': \'FailedToSatisfyReadPreference\', \'$clusterTime\': {\'clusterTime\': Timestamp(1729647656, 2), \'signature\': {\'hash\': b\'\\xe9X\\xa4\\xae\\xaa#AP\\x14\\xedB\\xf1p\\xce\\xc6n\\x91\\xe7u\\xd0\', \'keyId\': 7428779192705089561}}, \'operationTime\': Timestamp(1729647656, 2)}')
unit-config-server-0: 01:40:56 ERROR unit.config-server/0.juju-log config-server:8: Failed to add shard-two to cluster
unit-config-server-0: 01:40:56 ERROR unit.config-server/0.juju-log config-server:8: Deferring _on_relation_event for shards interface since: error=OperationFailure('Could not find host matching read preference { mode: "primary" } for set shard-two, full error: {\'ok\': 0.0, \'errmsg\': \'Could not find host matching read preference { mode: "primary" } for set shard-two\', \'code\': 133, \'codeName\': \'FailedToSatisfyReadPreference\', \'$clusterTime\': {\'clusterTime\': Timestamp(1729647656, 2), \'signature\': {\'hash\': b\'\\xe9X\\xa4\\xae\\xaa#AP\\x14\\xedB\\xf1p\\xce\\xc6n\\x91\\xe7u\\xd0\', \'keyId\': 7428779192705089561}}, \'operationTime\': Timestamp(1729647656, 2)}')

[32mINFO    [0m pytest_operator.plugin:plugin.py:991 Forgetting model main...